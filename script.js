document.addEventListener("DOMContentLoaded", () => {
    // Slideshow alapb√≥l elrejtve
    const slideshowSection = document.querySelector('.slideshow-wrapper');
    slideshowSection.style.display = 'none';
    slideshowSection.style.opacity = '0';
    slideshowSection.style.transform = 'translateY(20px)';
    slideshowSection.style.transition = 'all 0.6s ease';

    // Slideshow toggle gomb
    const toggleBtn = document.getElementById('toggle-slideshow');
    toggleBtn.addEventListener('click', () => {
        if (slideshowSection.style.display === 'none' || slideshowSection.style.opacity === '0') {
            slideshowSection.style.display = 'block';
            setTimeout(() => {
                slideshowSection.style.opacity = '1';
                slideshowSection.style.transform = 'translateY(0)';
            }, 10);
        } else {
            slideshowSection.style.opacity = '0';
            slideshowSection.style.transform = 'translateY(20px)';
            setTimeout(() => {
                slideshowSection.style.display = 'none';
            }, 600);
        }
    });

    // Slideshow m≈±k√∂d√©s
    const slides = document.querySelectorAll('.slide');
    const prev = document.querySelector('.prev');
    const next = document.querySelector('.next');
    const dotsContainer = document.querySelector('.dots');
    let slideIndex = 0;

    slides.forEach((_, i) => {
        const dot = document.createElement('span');
        dot.classList.add('dot');
        dot.addEventListener('click', () => showSlide(i));
        dotsContainer.appendChild(dot);
    });
    const dots = document.querySelectorAll('.dot');
    if (dots[0]) dots[0].classList.add('active');

    function showSlide(n) {
        slideIndex = (n + slides.length) % slides.length;
        slides.forEach(s => s.classList.remove('active'));
        dots.forEach(d => d.classList.remove('active'));
        slides[slideIndex].classList.add('active');
        dots[slideIndex].classList.add('active');
    }

    if (prev) prev.addEventListener('click', () => showSlide(slideIndex - 1));
    if (next) next.addEventListener('click', () => showSlide(slideIndex + 1));

    setInterval(() => showSlide(slideIndex + 1), 5000);
});

// Hamburger toggle
const hamburger = document.getElementById('hamburger');
const navMenu = document.getElementById('nav-menu');
if (hamburger && navMenu) {
    hamburger.addEventListener('click', () => { navMenu.classList.toggle('show'); });
}

// Member card toggle
document.querySelectorAll('.member-toggle').forEach(toggle => {
    toggle.addEventListener('click', () => {
        const arrow = toggle.querySelector('.member-arrow');
        const extra = toggle.nextElementSibling; 
        extra.classList.toggle('show');
        arrow.classList.toggle('open');
    });
});

// -------------------- Fejleszt≈ëi eszk√∂z√∂k tilt√°sa --------------------
var isCtrl = false;
document.onkeyup = function(e){ if(e.which==17) isCtrl=false; }
document.onkeydown = function(e){
    if(e.which==17) isCtrl=true;
    if(((e.which==85)||(e.which==65)||(e.which==88)||(e.which==67)||(e.which==86)||(e.which==123)||(e.which==83)) && isCtrl){
        alert('nuh-uh'); return false;
    }
}
document.addEventListener('contextmenu', e => e.preventDefault());
function ctrlShiftKey(e,keyCode){return e.ctrlKey && e.shiftKey && e.keyCode===keyCode.charCodeAt(0);}
document.onkeydown = (e)=>{
    if(e.keyCode===123 || ctrlShiftKey(e,'I') || ctrlShiftKey(e,'J') || ctrlShiftKey(e,'C') || (e.ctrlKey && e.keyCode==='U'.charCodeAt(0))){
        alert('nuh-uh'); return false;
    }
}
document.onselectstart=()=>false;
if(window.sidebar){document.onmousedown=()=>false;document.onclick=()=>true;}

// -------------------- Canvas Background --------------------
const canvas = document.getElementById('bg-circles');
const ctx = canvas.getContext('2d');
let width,height;
let layers=[];
let mouseX=window.innerWidth/2, mouseY=window.innerHeight/2, scrollY=0;

function Circle(layer){
    this.x = Math.random()*width;
    this.baseY = Math.random()*height;
    this.baseRadius = 10 + Math.random()*(layer===0?30:layer===1?40:60);
    this.radius = this.baseRadius;
    this.speedX = (Math.random()-0.5)*(layer===0?0.2:layer===1?0.4:0.7);
    this.speedY = (Math.random()-0.5)*(layer===0?0.2:layer===1?0.4:0.7);
    this.hue = 180 + Math.random()*60;
    this.layer = layer;
    this.parallaxX = 0;
    this.parallaxY = 0;
    this.pulseOffset = Math.random()*Math.PI*2;
    this.trail = [];
}

Circle.prototype.update=function(){
    this.x+=this.speedX;
    this.baseY+=this.speedY;
    if(this.x<-this.radius)this.x=width+this.radius;
    if(this.x>width+this.radius)this.x=-this.radius;
    if(this.baseY<-this.radius)this.baseY=height+this.radius;
    if(this.baseY>height)this.baseY=-this.radius;
    const parallaxFactor = this.layer===0?0.01:this.layer===1?0.02:0.04;
    this.parallaxX=(mouseX-width/2)*parallaxFactor;
    this.parallaxY=(mouseY-height/2)*parallaxFactor+scrollY*parallaxFactor*2;
    this.radius=this.baseRadius*(0.85+0.15*Math.sin(Date.now()*0.002+this.pulseOffset));
    this.hue=180+60*Math.sin(Date.now()*0.001+this.pulseOffset);
    this.trail.push({x:this.x+this.parallaxX, y:this.baseY+this.parallaxY, alpha:0.5, radius:this.radius, hue:this.hue});
    if(this.trail.length>25)this.trail.shift();
};

Circle.prototype.draw=function(){
    for(let i=0;i<this.trail.length;i++){
        const t=this.trail[i];
        ctx.beginPath();
        ctx.arc(t.x,t.y,t.radius*(i/this.trail.length*0.8+0.2),0,Math.PI*2);
        ctx.fillStyle=`hsla(${t.hue},80%,60%,${t.alpha*(i/this.trail.length)})`;
        ctx.fill();
    }
    ctx.beginPath();
    const color=`hsl(${this.hue},80%,60%)`;
    ctx.fillStyle=color;
    ctx.shadowColor=color;
    ctx.shadowBlur=30;
    ctx.arc(this.x+this.parallaxX,this.baseY+this.parallaxY,this.radius,0,Math.PI*2);
    ctx.fill();
};

window.addEventListener('mousemove', e=>{mouseX=e.clientX;mouseY=e.clientY;});
window.addEventListener('scroll', ()=>{scrollY=window.scrollY;});

function init(){
    width=window.innerWidth;
    height=window.innerHeight;
    canvas.width=width;
    canvas.height=height;
    layers=[[],[],[]];
    for(let l=0;l<3;l++){
        let count=l===0?10:l===1?15:20;
        for(let i=0;i<count;i++) layers[l].push(new Circle(l));
    }
}

function animate(){
    ctx.fillStyle='rgba(0,0,50,0.18)';
    ctx.fillRect(0,0,width,height);
    layers.forEach(layer=>layer.forEach(c=>{c.update();c.draw();}));
    requestAnimationFrame(animate);
}

window.addEventListener('resize',init);
init();
animate();

// -------------------- √ìra --------------------
function updateClock(){
    const now=new Date();
    const h=String(now.getHours()).padStart(2,'0');
    const m=String(now.getMinutes()).padStart(2,'0');
    const s=String(now.getSeconds()).padStart(2,'0');
    const clockElement=document.getElementById('real-time-clock');
    if(clockElement){clockElement.textContent=`${h}:${m}:${s}`;}
}
setInterval(updateClock,1000);
updateClock();

// Scroll anim√°ci√≥
const observer = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{if(entry.isIntersecting) entry.target.classList.add('show');});
},{threshold:0.15});
document.querySelectorAll("section, .member-card").forEach(el=>observer.observe(el));

// =========================================================
// üí¨ CHATBOT V4.0 - KULCSSZAVAS, API KULCS N√âLK√úLI LOGIKA
// =========================================================

const chatBtn = document.getElementById('toggle-chat');
const chatBox = document.getElementById('chat-box');
const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-chat');
const chatMessages = document.getElementById('chat-messages');

// alapb√≥l elrejtve
chatBox.style.display = 'none';
chatBox.style.opacity = '0';
chatBox.style.transform = 'translateY(20px)';
chatBox.style.transition = 'all 0.4s ease';

chatBtn.addEventListener('click', () => {
    if (chatBox.style.display === 'none' || chatBox.style.opacity === '0') {
        chatBox.style.display = 'flex';
        setTimeout(() => { chatBox.style.opacity = '1'; chatBox.style.transform = 'translateY(0)'; }, 10);
    } else {
        chatBox.style.opacity = '0';
        chatBox.style.transform = 'translateY(20px)';
        setTimeout(() => { chatBox.style.display = 'none'; }, 400);
    }
});

// ü§ñ Szimul√°lt Chatbot Logika (Kulcsszavakra √©p√ºl≈ë)
const BOT_RESPONSES = {
    "f≈ëoldal": "A f≈ëoldalon tal√°lod a c√©g√ºnk log√≥j√°t, a val√≥s idej≈± √≥r√°t √©s a SRT. Id≈ëz√≠t≈ë let√∂lt√©si linkj√©t.",
    "r√≥lunk": "C√©g√ºnk piacvezet≈ë a k√©k g√∂mb√∂s h√°tter≈± weboldalak ter√ºlet√©n. K√ºldet√©s√ºnk: Dedicated for you!",
    "csapat": "A csapat tagjai: Barta √Åd√°m (Fejleszt≈ë), Gombos B√°lint (Designer) √©s Beluscs√°k Zsolt (Fejleszt≈ë).",
    "kapcsolat": "K√©rj√ºk, vedd fel a kapcsolatot e-mailben a megadott c√≠meken: bartaa@kkszki.hu, gombosb@kkszki.hu, beluscsakzs@kkszki.hu.",
    "sr id≈ëz√≠t≈ë": "Az SRT. Id≈ëz√≠t≈ë egy hasznos szoftver, melyet a f≈ëoldalon tudsz let√∂lteni a 'SRT. Id≈ëz√≠t≈ë let√∂lt√©se' gombbal.",
    "hello": "Szia! Miben seg√≠thetek ma? K√©rdezhetsz a 'R√≥lunk', 'Csapat' vagy 'SRT Id≈ëz√≠t≈ë' t√©m√°kban.",
    "szia": "Szia! Miben seg√≠thetek ma? K√©rdezhetsz a 'R√≥lunk', 'Csapat' vagy 'SRT Id≈ëz√≠t≈ë' t√©m√°kban.",
    "k√∂sz√∂n√∂m": "Sz√≠vesen! B√°rmi m√°sban seg√≠thetek?",
    // Alap√©rtelmezett, ha nem tal√°l tal√°latot:
    "default": "Sajn√°lom, erre a k√©rd√©sre m√©g nem tudok v√°laszolni. K√©rlek, pr√≥b√°ld meg m√°sk√©pp vagy v√°lassz egyet a f≈ë t√©m√°k k√∂z√ºl (pl. R√≥lunk, Csapat)."
};

function getBotResponse(message) {
    const lowerCaseMsg = message.toLowerCase();
    
    // Keres√©s az el≈ëre defini√°lt kulcsszavakban
    for (const key in BOT_RESPONSES) {
        if (lowerCaseMsg.includes(key)) {
            return BOT_RESPONSES[key];
        }
    }
    return BOT_RESPONSES["default"];
}

function appendMessage(message, className) {
    const msgElement = document.createElement('div');
    msgElement.className = className;
    msgElement.textContent = message;
    chatMessages.appendChild(msgElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function sendMessageToBot(message) {
    // Felhaszn√°l√≥ √ºzenete
    appendMessage(message, 'user-msg');
    chatInput.value = '';
    
    // Bot v√°lasza - szimul√°lunk egy kis k√©sleltet√©st a val√≥s hat√°s√©rt
    const typingIndicator = appendMessage('...', 'bot-msg');

    setTimeout(() => {
        const botResponse = getBotResponse(message);
        // T√∂r√∂lj√ºk a '...'
        chatMessages.removeChild(chatMessages.lastElementChild); 
        
        // Hozz√°adjuk a val√≥s v√°laszt
        appendMessage(botResponse, 'bot-msg');
    }, 500); 
}

sendBtn.addEventListener('click', () => {
    const msg = chatInput.value.trim();
    if (msg) sendMessageToBot(msg);
});

chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendBtn.click();
});