<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bombasz Vids</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=1.1">
    <style>
        body * {
            cursor: default !important;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #444;
            width: 0;
            transition: width 0.3s ease-out;
            border-radius: 0;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: #111;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .series-page-bg {
            pointer-events: none;
            /* Átengedi a kattintást az alatta lévő elemekre */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            /* Az app mögött (ami 1), de a body felett */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 0.5s ease;
            filter: blur(10px);
            transform: scale(1.05);
        }

        .series-page-bg.visible {
            opacity: 0.6 !important;
            /* Emeltem az átlátszóságon, hogy látszódjon */
        }

        /* EZRE CSERÉLD LE: */
        .series-page-bg.visible {
            opacity: 0.5;
        }

        #login-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: #1A1A1A;
            border-radius: 0;
            padding: 40px;
            width: 90%;
            max-width: 380px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.8), inset 0 0 5px rgba(255, 255, 255, 0.05);
        }

        #login-container h2 {
            text-align: center;
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        #login-container input {
            padding: 12px;
            border-radius: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            margin-top: 6px;
            transition: all 0.3s;
        }

        #login-container input:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: #444;
            box-shadow: 0 0 10px rgba(68, 68, 68, 0.3);
            outline: none;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 0;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }

        .btn.fill {
            background: #252525;
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .btn.fill:hover {
            background: #444;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        #app {
            position: relative;
            z-index: 1;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            flex-direction: column;
            height: 100vh;
            width: 100vw;

            /* Ez a sor a legfontosabb: */
            background: transparent !important;
            z-index: 1;
        }

        header {
            box-shadow: none;

            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px 30px;

            position: relative;
        }

        #profile-btn,
        #logout-btn {
            transition: color 0.3s, transform 0.3s;
            background: none;
            border: none;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
        }

        #profile-btn:hover,
        #logout-btn:hover {
            color: #bbb;
            transform: scale(1.1);
        }

        #logout-btn {
            color: #fff;
            border-radius: 0;
            padding: 5px 8px;
        }

        #logout-btn:hover {
            background: #444;
            box-shadow: none;
        }

        #profile-dropdown {
            position: absolute;
            right: 0;
            top: 45px;
            background: #222;
            border-radius: 0;
            padding: 15px;
            min-width: 250px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: none;
        }

        #watched-list {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #444;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .watched-item {
            display: flex;
            flex-direction: column;
            padding: 8px;
            background: #1A1A1A;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid #1A1A1A;
            font-size: 0.9rem;
        }

        .watched-item:hover {
            background: #252525;
        }

        .watched-title {
            font-weight: 600;
            margin-bottom: 3px;
            color: #bbb;
        }

        .watched-progress-text {
            font-size: 0.8em;
            color: #777;
        }

        #search-container {
            position: relative;
        }

        /* Ezt a részt cseréld a stílusaid között */
        #search-input {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            padding: 8px 0;
            border: none;
            border-radius: 4px;
            transition: all 0.3s ease-in-out;
            opacity: 0;
            background: #222;
            color: #fff;
            z-index: 10;
        }

        #search-container.active #search-input {
            width: 180px;
            padding: 8px 35px 8px 15px;
            opacity: 1;
        }

        /* Ez megvédi a logót mobilon */
        @media(max-width: 768px) {
            #home-btn {
                font-size: 1.2rem;
                white-space: nowrap;
            }

            #search-container.active #search-input {
                width: 130px;
            }
        }

        #search-clear-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            /* Középre igazítás */
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #fff;

            font-size: 1.5rem;
            width: 30px;
            height: 30px;
            display: none;
            /* Alapból rejtve */
            z-index: 20;
            pointer-events: auto !important;
            /* Engedélyezzük a kattintást */
            align-items: center;
            justify-content: center;
        }

        #search-container.active #search-clear-btn {
            opacity: 1;
            pointer-events: auto;
        }


        .main-page {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: flex-start;
            gap: 20px;
            padding: 40px;
            flex: 1;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            transition: filter 0.5s ease;
        }

        .series-card {
            width: 180px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border-radius: 0;
            overflow: hidden;
            background: #1A1A1A;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
            padding-bottom: 5px;
        }

        .series-card:hover {
            transform: none;
            box-shadow: none;
            background: #252525;
        }

        .series-card img {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            display: block;
            border-radius: 0;
            transition: transform 0.3s ease-out;
        }

        .series-card:hover img {
            transform: none;
        }

.series-title {
    width: 100%;
    height: 35px;
    overflow: hidden; /* Ez vágja le a kilógó részt */
    position: relative;
    white-space: nowrap;
    padding: 5px 0;
}

.series-title span {
    display: inline-block; /* Fontos a méréshez és mozgatáshoz */
    padding-left: 10px;
    will-change: transform;
}

/* Az animáció, ami a transzformációt végzi */
@keyframes smoothScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); } 
    /* Azért -50%, mert a JS megduplázza a szöveget */
}

.series-title.scrolling-title span {
    animation: smoothScroll linear infinite;
}

        @keyframes smoothScroll {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .series-page {
            display: none;
            flex: 1;
            height: calc(100vh - 60px);
            /* Kiszámolja a maradék helyet a header alatt */
            flex-direction: row;
            align-items: flex-start;
            /* Fontos: megakadályozza, hogy a sidebar függőlegesen kinyúljon */
        }

        /* A javított sidebar stílus */
        .sidebar {
            width: 240px;
            height: fit-content;
            /* Csak a tartalom (részek) végéig ér */
            max-height: calc(100vh - 100px);
            /* Megakadályozza, hogy túl sok résznél kilógjon a képernyőről */
            background: rgba(0, 0, 0, 0.3) !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            /* Ha sok rész van, ezen belül lehet görgetni */
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 20px;
            /* Modern, lebegő hatást ad neki */
            border-radius: 4px;
        }

        .sidebar::-webkit-scrollbar {
            display: none;
            width: 0 !important;
        }

        .sidebar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .sidebar h2 {
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 20px;
        }

        .video-card {
            background: #252525;
            border-radius: 0;
            padding: 10px;
            transition: background 0.2s, border-color 0.2s, transform 0.2s;
            border: 1px solid transparent;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            color: #bbb;
        }

        .video-card.active {
            border-color: #444;
            background: #444;
            color: #fff;
            transform: scale(1.02);
            font-weight: 600;
        }

        .video-card.active .fa-check {
            color: #fff;
        }

        .video-card:not(.active):hover {
            background: #383838;
            transform: scale(1.01);
            border-color: #444;
            color: #fff;
        }

        .video-card.watched:not(.active) {
            background: #161616;
            color: #777;
            border-color: #161616;
        }

        .video-card.watched:not(.active):hover {
            background: #222;
        }

        .watched .fa-check {
            color: #4cff7f;
            margin-left: 5px;
        }


        .video-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            order: 1;
            align-items: center;
            max-width: min(1300px, 85vw);
            margin: 0 auto;
            height: 100%;
            /* A háttérszínt töröltük, hogy átlátszódjon a dinamikus kép */
            background: transparent;
            border-radius: 0;
        }

        .video-frame-container {
            width: 100%;
            position: relative;
            height: 0;
            padding-top: 56.25%;
            max-width: 100%;
            flex-shrink: 0;
            overflow: hidden;
        }

        .video-frame-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
            border-radius: 0;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.8);
        }

        .video-frame-container iframe.indavideo-player {
            width: 100%;
            height: 100%;
        }


        #nextEpisodeBtn {
            background: #252525;
            color: #fff;
            border: 2px solid #444;
            padding: 10px 20px;
            border-radius: 0;
            cursor: pointer;
            margin-top: 20px;
            margin-bottom: 20px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        #nextEpisodeBtn:hover {
            background: #444;
            transform: translateY(-2px);
            border-color: #bbb;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        .back-button {
            background: #444;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 0;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
        }

        .back-button:hover {
            background: #555;
            transform: scale(1.05);
        }

        @media(max-width:768px) {

            body {
                align-items: flex-start;
                padding-top: 5vh;
                min-height: auto;
            }

            #login-container {
                margin: 0 auto;
            }

            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 30px;

                /* Sticky pozíció: így görgetésnél is látszik az üveg hatás */
                position: sticky;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;

                /* Áttetsző sötét háttér */
                background: rgba(0, 0, 0, 0.4) !important;

                /* Üveg hatás (homályosítás) */
                backdrop-filter: blur(15px) !important;
                -webkit-backdrop-filter: blur(15px) !important;

                /* Elegáns választóvonal */
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
                box-shadow: none !important;

                /* Simább átmenet a színek között */
                transition: background 0.3s ease;
            }

            /* Mobil optimalizálás a headernek */
            /* MOBIL NÉZET JAVÍTÁSA - CSAK 768px ALATT */
            /* MOBIL NÉZET JAVÍTÁSA - CSAK 768px ALATT */
            @media(max-width:768px) {
                body {
                    display: block !important;
                    overflow-x: hidden;
                    overflow-y: auto;
                    height: auto !important;
                    min-height: 100vh;
                }

                /* FIX HEADER MOBILON */
                header {
                    position: fixed !important;
                    /* Fixen rögzítjük a tetején */
                    top: 0;
                    left: 0;
                    width: 100%;
                    z-index: 2000 !important;
                    /* Hogy minden felett legyen */
                    box-sizing: border-box;
                    background: rgba(17, 17, 17, 0.95) !important;
                    backdrop-filter: blur(10px);
                    height: 60px !important;
                    display: flex !important;
                    padding: 0 15px !important;
                }

                #app {
                    display: none;
                    flex-direction: column !important;
                    height: auto !important;
                    min-height: 100vh;
                    padding-top: 60px !important;
                    /* Helyet hagyunk a fix fejlécnek */
                    overflow-y: visible !important;
                }

                .series-page {
                    flex-direction: column !important;
                    height: auto !important;
                    padding-bottom: 50px;
                }

                /* VIDEÓ RÉSZ: Mobilon legyen felül */
                .video-content-wrapper {
                    width: 100% !important;
                    max-width: 100% !important;
                    padding: 10px !important;
                    margin: 0 !important;
                    order: 0 !important;
                    height: auto !important;
                    flex: none !important;
                }

                .video-frame-container {
                    padding-top: 56.25% !important;
                    height: 0 !important;
                    position: relative !important;
                    display: block !important;
                }

                .video-frame-container iframe {
                    position: absolute !important;
                    top: 0;
                    left: 0;
                    width: 100% !important;
                    height: 100% !important;
                }

                /* SIDEBAR (Részek listája): A videó alá */
                .sidebar {
                    width: calc(100% - 30px) !important;
                    margin: 15px !important;
                    max-height: 300px !important;
                    order: 1 !important;
                    background: rgba(20, 20, 20, 0.9) !important;
                    border: 1px solid rgba(255, 255, 255, 0.1) !important;
                    flex: none !important;
                }

                #nextEpisodeBtn {
                    order: 2 !important;
                    width: calc(100% - 30px) !important;
                    margin: 10px 15px !important;
                }

                .main-page {
                    padding: 15px !important;
                    justify-content: center !important;
                }

                .series-card {
                    width: 140px !important;
                }
            }

            .series-title {
                font-size: 0.85rem;
            }

            .series-page {
                flex-direction: column;
                overflow-y: auto;
                height: 100vh;
            }

            .sidebar {
                width: 240px;
                height: auto;
                max-height: 250px;
                padding: 20px;
                order: 1;
                background: rgba(17, 17, 17, 0.8);
            }

            .video-content-wrapper {
                height: 220px;
                flex: none;
                padding: 15px;
                order: 0;
                background: none;
                margin: 0;
                max-width: 100%;
            }

            .video-frame-container {
                padding-top: 0;
                height: 100%;
            }

            .sidebar h2 {
                margin-bottom: 5px;
                font-size: 1.2rem;
            }

            .video-card {
                font-size: 12px;
                padding: 8px;
                border-radius: 0;
            }

            #nextEpisodeBtn {
                margin-top: 15px;
                max-width: 100%;
                border-radius: 0;
            }

        }

        @media(max-width:480px) {
            .series-card {
                width: 120px;
                margin: 0 auto;
            }

            .series-title {
                font-size: 0.8rem;
            }

            #login-container {
                padding: 30px 20px;
            }
        }

        /* Ambilight konténer */
        /* Konténer igazítása */
        .ambilight-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            z-index: 1;
        }

        /* AMBILIGHT: Ez a réteg adja a tényleges fényt */
        #ambilightGlowContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            z-index: -1;
            /* Pontosan a fővideó mögött */
            transform: translate(-50%, -50%) scale(1.2, 1.3);
            opacity: 0;
            /* Brutális elmosás és színerősség - FEHÉRNÉL FEHÉR LESZ */
            filter: blur(120px) saturate(1.8) brightness(1.4);
            pointer-events: none;
            display: none;
            transition: opacity 0.8s ease;
        }

        #ambilightGlowContainer iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Aktiválás */
        .ambilight-active #ambilightGlowContainer {
            display: block;
            opacity: 1 !important;
        }

        .theater-mode-on .ambilight-wrapper {
            max-width: 100% !important;
            width: 100% !important;
        }

        /* Mozi mód méretek */
        .theater-mode-on .video-content-wrapper {
            max-width: 95vw !important;
            /* Szinte teljes szélesség */
            width: 95vw !important;
            padding: 20px 0 !important;
            /* Kevesebb margó, több videó */
        }

        .theater-mode-on .video-frame-container {
            box-shadow: 0 0 80px rgba(0, 0, 0, 1);
            z-index: 10;
        }

        #theaterBtn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .theater-mode-on:hover #theaterBtn,
        #theaterBtn:hover {
            opacity: 1;
        }

        #theaterBtn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ccc;
            padding: 10px 20px;
            margin-top: 15px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .theater-mode-on #theaterBtn {
            position: fixed;
            bottom: 25px;
            /* Kicsit lejjebb toltuk */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
        }

        .theater-mode-on:hover #theaterBtn {
            opacity: 1;
        }

        #theaterBtn.active {
            background: #4cff7f;
            color: #000;
        }

        /* Amikor a mozi mód aktív */
        /* Mozi mód alapjai */
        .theater-mode-on body {
            background: #000 !important;
        }

        .theater-mode-on #app {
            background: #000 !important;
        }

        /* Sidebar elrejtése */
        .theater-mode-on .sidebar {
            display: none !important;
        }

        /* Konténer méretezése: Nem túl nagy, de központozott */
        .theater-mode-on .video-content-wrapper {
            max-width: 85vw !important;
            width: 85vw !important;
            padding: 40px 0 !important;
            background: transparent !important;
        }

        /* Ambilight (Háttérvilágítás) réteg stílusa */
        .theater-mode-on .video-content-wrapper {
            max-width: 80vw !important;
            width: 80vw !important;
            padding: 60px 0 !important;
            background: transparent !important;
        }

        /* AMBILIGHT: Extrém kiterjedés és intenzitás */
        #ambilightGlowContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            z-index: -1;
            /* Scale: 1.25 elég, mert a videó már alapból hatalmas, 
       így a fény pont a széleken fog ragyogni */
            transform: translate(-50%, -50%) scale(1.25, 1.2);
            filter: blur(150px) saturate(2.2) brightness(1.4);
            pointer-events: none;
            display: none;
            transition: opacity 1s ease;
        }

        /* Teljes fényerő bekapcsolva */
        .ambilight-active #ambilightGlowContainer {
            opacity: 0.9 !important;
            display: block;
        }

        /* Sötét keret a videó körül, hogy elváljon a háttértől */
        .theater-mode-on .video-frame-container {
            box-shadow: 0 0 60px 10px rgba(0, 0, 0, 0.8);
            z-index: 2;
        }

        .ambilight-active #ambilightGlowContainer {
            display: block;
        }

        /* Az iframe-ek méretezése a konténeren belül */
        #ambilightGlowContainer iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* A főoldal és egyéb elemek sötétítése mozi módban */
        .theater-mode-on header,
        .theater-mode-on #dynamicBackground {
            opacity: 0 !important;
            pointer-events: none;
        }

        .theater-mode-on {
            background: #000 !important;
        }

        .theater-mode-on header {
            display: none !important;
            /* Elrejti a logót és a profilod mozi módban */
        }
    </style>
</head>

<body>
    <div id="dynamicBackground" class="series-page-bg"></div>

    <div id="login-container">
        <center>
            <h2>Belépés</h2>
            <form id="login-form" novalidate>
                <label>E-mail <br>
                    <input type="email" id="loginEmail" required>
                </label><br><br>
                <label>Jelszó <br>
                    <input type="password" id="loginPassword" minlength="6" required>
                </label><br><br>
                <button type="submit" class="btn fill">Belépés</button>
                <p id="login-msg" class="form-msg" role="status" aria-live="polite"></p>
            </form>
        </center>
    </div>

    <div id="app">
        <header>
            <h2 id="home-btn">Bombasz Vids</h2>
            <div id="profile-area" style="display:flex; align-items:center; gap:12px; position:relative;">
                <div id="search-container">
                    <input type="text" id="search-input" placeholder="Keresés...">
                    <button id="search-clear-btn" aria-label="Keresés törlése" style="display:none;">&times;</button>
                </div>
                <button id="search-btn"
                    style="background:none; border:none; cursor:pointer; color:#fff; display:flex; align-items:center; justify-content:center; width:32px; height:32px;">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>

                <div id="online-counter" style="display: none; align-items: center; gap: 6px;">
                    <div
                        style="width: 8px; height: 8px; background-color: #4cff7f; border-radius: 50%; box-shadow: 0 0 8px #4cff7f;">
                    </div>
                    <span id="user-count" style="font-size: 0.9rem; color: #4cff7f; font-weight: 600;">0</span>
                </div>

                <button id="profile-btn"><i class="fa-solid fa-user"></i> <span id="username-display"></span></button>

                <div id="profile-dropdown">
                    <p><strong>Üdv,</strong> <span id="profile-name"></span></p>
                    <p style="font-weight: 600; margin-top: 15px; border-top: 1px solid #444; padding-top: 10px;">
                        Legutóbb nézettek:</p>
                    <div id="watched-list" style="display: flex; flex-direction: column; gap: 5px;">
                        <p style="font-size: 0.85rem; color: #777;">Betöltés...</p>
                    </div>
                    <br>
                    <button id="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Kilépés</button>
                </div>
            </div>
        </header>

        <div class="main-page" id="mainPage">
            <div class="series-card" data-series="chainsaw-movie">
                <img src="./reze.png" alt="Chainsaw Man: Reze Arc">
                <div class="series-title"><span>Chainsaw Man - The Movie: Reze Arc</span></div>
            </div>
            <div class="series-card" data-series="chainsaw-series">
                <img src="./chainsawman.webp" alt="Chainsaw Man">
                <div class="series-title"><span>Chainsaw Man</span></div>
            </div>
            <div class="series-card" data-series="deathnote">
                <img src="./deathnote.avif" alt="Death Note">
                <div class="series-title"><span>Death Note</span></div>
            </div>
            <div class="series-card" data-series="record-of-ragnarok-s1">
                <img src="./recordofragnaroks1.jpg" alt="Record of Ragnarok: Season 1">
                <div class="series-title"><span>Record of Ragnarok: Season 1</span></div>
            </div>
            <div class="series-card" data-series="record-of-ragnarok-s2">
                <img src="./recordofragnaroks2.jpg" alt="Record of Ragnarok: Season 2">
                <div class="series-title"><span>Record of Ragnarok: Season 2</span></div>
            </div>

            <div class="series-card" data-series="record-of-ragnarok-s3">
                <img src="./recordofragnaroks3.jpg" alt="Record of Ragnarok: Season 3">
                <div class="series-title"><span>Record of Ragnarok: Season 3</span></div>
            </div>

            <div class="series-card" data-series="Evangelion">
                <img src="./evangelion.jpg" alt="Neon Genesis Evangelion">
                <div class="series-title"><span>Neon Genesis Evangelion</span></div>
            </div>

            <div class="series-card" data-series="endofevangelion">
                <img src="./endofevangelion.jpg" alt="Neon Genesis Evangelion">
                <div class="series-title"><span>Neon Genesis Evangelion: The End of Evangelion</span></div>
            </div>
            <div class="series-card" data-series="youarenotalone">
                <img src="youarenptalone.webp" alt="Neon Genesis Evangelion: You Are Not Alone">
                <div class="series-title"><span>Evangelion - 1.0 You Are (Not) Alone</span></div>
            </div>
            <div class="series-card" data-series="youcannotadvance">
                <img src="youcannotadvance.jpg" alt="Evangelion - 2.0 You Can (Not) Advance">
                <div class="series-title"><span>Evangelion - 2.0 You Can (Not) Advance</span></div>
            </div>
            <div class="series-card" data-series="youcannotredo">
                <img src="youcannotredo.jpg" alt="Evangelion 3.0 You Can (Not) Redo">
                <div class="series-title"><span>Evangelion 3.0 You Can (Not) Redo</span></div>
            </div>
            <div class="series-card" data-series="thriceuponatime">
                <img src="thriceuponatime.webp" alt="Evangelion 3.0 You Can (Not) Redo">
                <div class="series-title"><span>Evangelion: 3.0+1.0 Thrice Upon a Time</span></div>
            </div>
            <div class="series-card" data-series="degeneration">
                <img src="degeneration.jpg" alt="Resident Evil: Degeneration">
                <div class="series-title"><span>Resident Evil: Degeneration</span></div>
            </div>
            <div class="series-card" data-series="infinitedarkness">
                <img src="infinitedarkness.jpg" alt="Resident Evil: Infinite Darkness">
                <div class="series-title"><span>Resident Evil: Infinite Darkness</span></div>
            </div>
            <div class="series-card" data-series="damnation">
                <img src="damnation.jpg" alt="Resident Evil: Damnation">
                <div class="series-title"><span>Resident Evil: Damnation</span></div>
            </div>
            <div class="series-card" data-series="vendetta">
                <img src="vendetta.jpg" alt="Resident Evil: Vendetta">
                <div class="series-title"><span>Resident Evil: Vendetta</span></div>
            </div>
            <div class="series-card" data-series="deathisland">
                <img src="deathisland.webp" alt="Resident Evil: Death Island">
                <div class="series-title"><span>Resident Evil: Death Island</span></div>
            </div>
            <div class="series-card" data-series="fallouts1">
                <img src="fallouts1.jpg" alt="Fallout Season 1">
                <div class="series-title"><span>Fallout Season 1</span></div>
            </div>
            <div class="series-card" data-series="fallouts2">
                <img src="fallouts2.jpg" alt="Fallout Season 2">
                <div class="series-title"><span>Fallout Season 2</span></div>
            </div>
        </div>

        <div class="series-page" id="seriesPage">
            <div class="sidebar">
                <button id="back-btn" class="back-button">
                    <i class="fa-solid fa-arrow-left"></i> Vissza
                </button>
                <h2 id="seriesTitle">Sorozat</h2>
                <div id="videoList"></div>
            </div>
            <div class="video-content-wrapper">
                <div class="ambilight-wrapper" id="ambilightWrapper">
                    <div id="ambilightGlowContainer"></div>

                    <div class="video-frame-container"></div>
                </div>

                <div style="display: flex; gap: 15px; align-items: center; justify-content: center; width: 100%;">
                    <button id="theaterBtn"><i class="fa-solid fa-expand"></i> Mozi mód</button>
                    <button id="nextEpisodeBtn" style="display:none; margin: 0;"></button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getDatabase, ref, set, get, child, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAwRrAtHaNRh2DLwVkryA3wSf86h7aQCaI",
            authDomain: "konyv-93c63.firebaseapp.com",
            projectId: "konyv-93c63",
            storageBucket: "konyv-93c63.firebasestorage.app",
            messagingSenderId: "349471560585",
            appId: "1:349471560585:web:55c6e78499ebbca0540758"
        };

        const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // DOM elemek
        const loginForm = document.getElementById("login-form");
        const loginMsg = document.getElementById("login-msg");
        const loginContainer = document.getElementById("login-container");
        const appContainer = document.getElementById("app");
        const logoutBtn = document.getElementById("logout-btn");
        const profileBtn = document.getElementById("profile-btn");
        const profileDropdown = document.getElementById("profile-dropdown");
        const usernameDisplay = document.getElementById("username-display");
        const profileName = document.getElementById("profile-name");
        const homeBtn = document.getElementById('home-btn');
        const watchedList = document.getElementById('watched-list');
        const searchBtn = document.getElementById('search-btn');
        const searchContainer = document.getElementById('search-container');
        const searchInput = document.getElementById('search-input');
        const searchClearBtn = document.getElementById('search-clear-btn');
        const mainPage = document.getElementById('mainPage');
        const seriesPage = document.getElementById('seriesPage');
        const videoList = document.getElementById('videoList');
        const seriesTitle = document.getElementById('seriesTitle');
        const backBtn = document.getElementById('back-btn');
        const nextEpisodeBtn = document.getElementById('nextEpisodeBtn');
        const dynamicBackground = document.getElementById('dynamicBackground');
        const theaterBtn = document.getElementById('theaterBtn');
        const ambilightWrapper = document.getElementById('ambilightWrapper');

        let allProgressData = {};

        // --- SOROZAT ADATOK ---
 const seriesData = {
            "chainsaw-movie": {
                title: "Chainsaw Man - The Movie: Reze Arc",
                videos: [
                    { title: "1. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234629758&id=456239018&hd=4", type: 'vkvideo' }
                ]
            },
            "chainsaw-series": {
                "title": "Chainsaw Man",
                "videos": [
                    { "title": "01. rész", "src": "https://mega.nz/embed/i34jHaxJ#2rze3ZC4mwLkf233l-cT-gNNElnZAtvoHJOJPfMilUI", "type": "videa" },
                    { "title": "02. rész", "src": "https://mega.nz/embed/nv4gVSgR#Ft3LTdB4j06VkdD4mxHcsfUhWnFtJqCI5Xj0jbHK6Yk", "type": "videa" },
                    { "title": "03. rész", "src": "https://mega.nz/embed/iiIShLKL#nfuCwaaQAIyPJlM-DAjJRAq-lM1JbjEe4L6D1xFAQ94", "type": "videa" },
                    { "title": "04. rész", "src": "https://mega.nz/embed/vyB3RK5Z#yImAcZSdffDJEAFCIaDVjci340cn8bfkfd3orp-gH4Q", "type": "videa" },
                    { "title": "05. rész", "src": "https://mega.nz/embed/7rRXRDZC#m0RE2jUHgznTcGPFrclDNP-xEyBCjHUeUYUu8FWdI0U", "type": "videa" },
                    { "title": "06. rész", "src": "https://mega.nz/embed/LqxzWTbb#eEDmR3m8_zIpeT-BdNfrKbp27yfZN7ZrYP5Ip2CwQjo", "type": "videa" },
                    { "title": "07. rész", "src": "https://mega.nz/embed/jvJiAAZD#ibghVyfWrp9WfpvkfBuC0O_yqgXpmU4IEb3uXgcqpMw", "type": "videa" },
                    { "title": "08. rész", "src": "https://mega.nz/embed/SrA3AaST#VlRTaCkuB3nnP_iRgd08_0T2HEOcWuoGLbblizEaY-Y", "type": "videa" },
                    { "title": "09. rész", "src": "https://mega.nz/embed/b7Yi1SCD#xLRyzn2Wd6QQ-ccEdA9o47GyrtAtMP8-CxJ7k9O1lGM", "type": "videa" },
                    { "title": "10. rész", "src": "https://mega.nz/embed/Hv5xDRZB#amCkiNUifgnaKxywkoCRWPNGV1c6NlpmdFxkQ95N1Ys", "type": "videa" },
                    { "title": "11. rész", "src": "https://mega.nz/embed/L2wREYAS#cULzLMKs-GY_V9btuCPko-L1jBENQNttm34Hsb14U5o", "type": "videa" },
                    { "title": "12. rész", "src": "https://mega.nz/embed/q3pDGRrR#OfHfr_Nxmxbi2Fplt3LnFaLtd_R9RpTQeiZIdTVf5Hg", "type": "videa" }
                ]
            },
            "deathnote": {
                title: "Death Note",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/0b203b1c34", type: 'indavideo' },
                    { title: "02. rész", src: "//embed.indavideo.hu/player/video/6933aa54b7", type: 'indavideo' },
                    { title: "03. rész", src: "//embed.indavideo.hu/player/video/e5784af123", type: 'indavideo' },
                    { title: "04. rész", src: "//embed.indavideo.hu/player/video/9a5c7dd313", type: 'indavideo' },
                    { title: "05. rész", src: "//embed.indavideo.hu/player/video/937eff53b8", type: 'indavideo' },
                    { title: "06. rész", src: "//embed.indavideo.hu/player/video/b943513e4f", type: 'indavideo' },
                    { title: "07. rész", src: "//embed.indavideo.hu/player/video/1970930830", type: 'indavideo' },
                    { title: "08. rész", src: "//embed.indavideo.hu/player/video/50222e8add", type: 'indavideo' },
                    { title: "09. rész", src: "//embed.indavideo.hu/player/video/d686d50524", type: 'indavideo' },
                    { title: "10. rész", src: "//embed.indavideo.hu/player/video/4d14107766", type: 'indavideo' },
                    { title: "11. rész", src: "//embed.indavideo.hu/player/video/795f8e280b", type: 'indavideo' },
                    { title: "12. rész", src: "//embed.indavideo.hu/player/video/70f38bd78a", type: 'indavideo' },
                    { title: "13. rész", src: "//embed.indavideo.hu/player/video/e3f848b673", type: 'indavideo' },
                    { title: "14. rész", src: "//embed.indavideo.hu/player/video/ea4479c6e8", type: 'indavideo' },
                    { title: "15. rész", src: "//embed.indavideo.hu/player/video/a7983034e3", type: 'indavideo' },
                    { title: "16. rész", src: "//embed.indavideo.hu/player/video/932d9f3317", type: 'indavideo' },
                    { title: "17. rész", src: "//embed.indavideo.hu/player/video/a4e723f5dc", type: 'indavideo' },
                    { title: "18. rész", src: "//embed.indavideo.hu/player/video/a273ea4497", type: 'indavideo' },
                    { title: "19. rész", src: "//embed.indavideo.hu/player/video/f3ce246582", type: 'indavideo' },
                    { title: "20. rész", src: "//embed.indavideo.hu/player/video/e5da6af423", type: 'indavideo' },
                    { title: "21. rész", src: "//embed.indavideo.hu/player/video/77979c4cac", type: 'indavideo' },
                    { title: "22. rész", src: "//embed.indavideo.hu/player/video/9e2463619c", type: 'indavideo' },
                    { title: "23. rész", src: "//embed.indavideo.hu/player/video/99c0d5fb6b", type: 'indavideo' },
                    { title: "24. rész", src: "//embed.indavideo.hu/player/video/71cd1036af", type: 'indavideo' },
                    { title: "25. rész", src: "//embed.indavideo.hu/player/video/c1e3575648", type: 'indavideo' },
                    { title: "26. rész", src: "//embed.indavideo.hu/player/video/a1c1127501", type: 'indavideo' },


                ]
            },
            "record-of-ragnarok-s1": {
                title: "Record of Ragnarok: Season 1",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/47eba82d74", type: 'indavideo' },
                    { title: "02. rész", src: "//embed.indavideo.hu/player/video/64bcd4632e", type: 'indavideo' },
                    { title: "03. rész", src: "//embed.indavideo.hu/player/video/415715ab33", type: 'indavideo' },
                    { title: "04. rész", src: "//embed.indavideo.hu/player/video/db57f4f66f", type: 'indavideo' },
                    { title: "05. rész", src: "//embed.indavideo.hu/player/video/0981a0913f", type: 'indavideo' },
                    { title: "06. rész", src: "//embed.indavideo.hu/player/video/53fe4c1471", type: 'indavideo' },
                    { title: "07. rész", src: "//embed.indavideo.hu/player/video/a2fad56e36", type: 'indavideo' },
                    { title: "08. rész", src: "//embed.indavideo.hu/player/video/2590d2b062", type: 'indavideo' },
                    { title: "09. rész", src: "//embed.indavideo.hu/player/video/8425e0a195", type: 'indavideo' },
                    { title: "10. rész", src: "//embed.indavideo.hu/player/video/556f010595", type: 'indavideo' },
                    { title: "11. rész", src: "//embed.indavideo.hu/player/video/7ee6e9fe63", type: 'indavideo' },
                    { title: "12. rész", src: "//embed.indavideo.hu/player/video/38d878ec19", type: 'indavideo' },
                ]
            },
            "record-of-ragnarok-s2": {
                title: "Record of Ragnarok: Season 2",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/b36154b500", type: 'indavideo' },
                    { title: "02. rész", src: "//embed.indavideo.hu/player/video/e2292c54d4", type: 'indavideo' },
                    { title: "03. rész", src: "//embed.indavideo.hu/player/video/072ed4adbf", type: 'indavideo' },
                    { title: "04. rész", src: "//embed.indavideo.hu/player/video/0598413057", type: 'indavideo' },
                    { title: "05. rész", src: "//embed.indavideo.hu/player/video/f305511ae3", type: 'indavideo' },
                    { title: "06. rész", src: "//embed.indavideo.hu/player/video/1cd39537c6", type: 'indavideo' },
                    { title: "07. rész", src: "//embed.indavideo.hu/player/video/d5ac5b4dad", type: 'indavideo' },
                    { title: "08. rész", src: "//embed.indavideo.hu/player/video/bcf75d3a74", type: 'indavideo' },
                    { title: "09. rész", src: "//embed.indavideo.hu/player/video/7b2bfcfb8b", type: 'indavideo' },
                    { title: "10. rész", src: "//embed.indavideo.hu/player/video/e3f5985a19", type: 'indavideo' },
                    { title: "11. rész", src: "//embed.indavideo.hu/player/video/d85f2d750b", type: 'indavideo' },
                    { title: "12. rész", src: "//embed.indavideo.hu/player/video/94bb4ca873", type: 'indavideo' },
                    { title: "13. rész", src: "//embed.indavideo.hu/player/video/5e5efceb4b", type: 'indavideo' },
                    { title: "14. rész", src: "//embed.indavideo.hu/player/video/49fcdfb7bd", type: 'indavideo' },
                    { title: "15. rész", src: "//embed.indavideo.hu/player/video/f2cec55687", type: 'indavideo' },
                ]
            },
            "record-of-ragnarok-s3": {
                title: "Record of Ragnarok: Season 3",
                videos: [
                    { title: "01. rész", src: "//videa.hu/player?v=fg5MMPRNCX0ArOrR", type: 'videa' },
                    { title: "02. rész", src: "//videa.hu/player?v=ZDf2cP8SmAXsEKrU", type: 'videa' },
                    { title: "03. rész", src: "//videa.hu/player?v=CHUtrQYTZQgl6T2j", type: 'videa' },
                    { title: "04. rész", src: "//videa.hu/player?v=QogXviAtwW63DrJE", type: 'videa' },
                    { title: "05. rész", src: "//videa.hu/player?v=eJZqfRGV1qrmYVh3", type: 'videa' },
                    { title: "06. rész", src: "//videa.hu/player?v=T8R4Y0FCfUV0TOG6", type: 'videa' },
                    { title: "07. rész", src: "//videa.hu/player?v=fTxYD90gq6lKy8Ud", type: 'videa' },
                    { title: "08. rész", src: "//videa.hu/player?v=Rt3codXW3Fuo7oc4", type: 'videa' },
                    { title: "09. rész", src: "//videa.hu/player?v=VxeSoFo0dKL3Hccf", type: 'videa' },
                    { title: "10. rész", src: "//videa.hu/player?v=rEDfQlR8loKDN9qn", type: 'videa' },
                    { title: "11. rész", src: "//videa.hu/player?v=I2zmWVBtqu6w0obg", type: 'videa' },
                    { title: "12. rész", src: "//videa.hu/player?v=7Jtoc1SjPAK0ery9", type: 'videa' },
                    { title: "13. rész", src: "//videa.hu/player?v=GzkmQWEW6MrNYDZq", type: 'videa' },
                    { title: "14. rész", src: "//videa.hu/player?v=uJD5594gZbZq5q40", type: 'videa' },
                    { title: "15. rész", src: "//videa.hu/player?v=vibakbKKhkPZX3Y9", type: 'videa' }
                ]
            },
            "Evangelion": {
                title: "Neon Genesis Evangelion",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/286a5eeac9", type: 'indavideo' },
                    { title: "02. rész", src: "//embed.indavideo.hu/player/video/dcb4c643c4", type: 'indavideo' },
                    { title: "03. rész", src: "//embed.indavideo.hu/player/video/729a1a303c", type: 'indavideo' },
                    { title: "04. rész", src: "//embed.indavideo.hu/player/video/0cad784310", type: 'indavideo' },
                    { title: "05. rész", src: "//embed.indavideo.hu/player/video/10982e58f7", type: 'indavideo' },
                    { title: "06. rész", src: "//embed.indavideo.hu/player/video/5c22325712", type: 'indavideo' },
                    { title: "07. rész", src: "//embed.indavideo.hu/player/video/15210731f0", type: 'indavideo' },
                    { title: "08. rész", src: "//embed.indavideo.hu/player/video/d3131c29a5", type: 'indavideo' },
                    { title: "09. rész", src: "//embed.indavideo.hu/player/video/8571557e9c", type: 'indavideo' },
                    { title: "10. rész", src: "//embed.indavideo.hu/player/video/205b9a6324", type: 'indavideo' },
                    { title: "11. rész", src: "//embed.indavideo.hu/player/video/9958e80402", type: 'indavideo' },
                    { title: "12. rész", src: "//embed.indavideo.hu/player/video/41d4d74d6a", type: 'indavideo' },
                    { title: "13. rész", src: "//embed.indavideo.hu/player/video/c9436061a6", type: 'indavideo' },
                    { title: "14. rész", src: "//embed.indavideo.hu/player/video/e651c54cdd", type: 'indavideo' },
                    { title: "15. rész", src: "//embed.indavideo.hu/player/video/b9e82c6005", type: 'indavideo' },
                    { title: "16. rész", src: "//embed.indavideo.hu/player/video/59a49ab193", type: 'indavideo' },
                    { title: "17. rész", src: "//embed.indavideo.hu/player/video/c8cddeaa1b", type: 'indavideo' },
                    { title: "18. rész", src: "//embed.indavideo.hu/player/video/a273ea4497", type: 'indavideo' },
                    { title: "19. rész", src: "//embed.indavideo.hu/player/video/f3ce246582", type: 'indavideo' },
                    { title: "20. rész", src: "//embed.indavideo.hu/player/video/e5da6af423", type: 'indavideo' },
                    { title: "21. rész", src: "//embed.indavideo.hu/player/video/77979c4cac", type: 'indavideo' },
                    { title: "22. rész", src: "//embed.indavideo.hu/player/video/9e2463619c", type: 'indavideo' },
                    { title: "23. rész", src: "//embed.indavideo.hu/player/video/99c0d5fb6b", type: 'indavideo' },
                    { title: "24. rész", src: "//embed.indavideo.hu/player/video/71cd1036af", type: 'indavideo' },
                    { title: "25. rész", src: "//embed.indavideo.hu/player/video/c1e3575648", type: 'indavideo' },
                    { title: "26. rész", src: "//embed.indavideo.hu/player/video/a1c1127501", type: 'indavideo' },


                ]
            },
            "endofevangelion": {
                title: "Neon Genesis Evangelion: The End of Evangelion",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239019&hash=7524c94b7253d358&hd=3", type: 'vkvideo' },

                ]
            },
            "youarenotalone": {
                title: "Evangelion - 1.0 You Are (Not) Alone",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/fac950fd5d", type: 'indavideo' },

                ]
            },
            "youcannotadvance": {
                title: "Evangelion - 2.0 You Can (Not) Advance",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/cc72e67144", type: 'indavideo' },

                ]
            },
            "youcannotredo": {
                title: "Evangelion 3.0 You Can (Not) Redo",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239020&hash=ac5e8053805aa170&hd=3", type: 'vkvideo' },

                ]
            },
            "thriceuponatime": {
                title: "Evangelion: 3.0+1.0 Thrice Upon a Time",
                videos: [
                    { title: "01. rész", src: "//embed.indavideo.hu/player/video/7b69d8bfb6", type: 'indavideo' },

                ]
            },
            "infinitedarkness": {
                title: "Resident Evil: Infinite Darkness",
                videos: [
                    { title: "01. rész", src: "///videa.hu/player?v=oVHAEHEE60URUsdG", type: 'videa' },
                    { title: "02. rész", src: "//videa.hu/player?v=sE41KsoAgb30Pd33", type: 'videa' },
                    { title: "03. rész", src: "//videa.hu/player?v=H96WiG6MlfGIs1Lb", type: 'videa' },
                    { title: "04. rész", src: "//videa.hu/player?v=kb7Dp5ZV0AuPINTe", type: 'videa' },


                ]
            },
            "degeneration": {
                title: "Resident Evil: Degeneration",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239021&hash=07ac20bef7a9f659&hd=3", type: 'vkvideo' },

                ]
            },

            "damnation": {
                title: "Resident Evil: Damnation",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239022&hash=fcd3a516e4019856&hd=3", type: 'vkvideo' },

                ]
            },

            "vendetta": {
                title: "Resident Evil: Vendetta",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239023&hash=01ba2a83353b4699&hd=3", type: 'vkvideo' },

                ]
            },

            "deathisland": {
                title: "Resident Evil: Death Island",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239024&hash=e03590ee5b52ea5e&hd=3", type: 'vkvideo' },

                ]
            },
            "fallouts1": {
                title: "Fallout Season 1 ",
                videos: [
                    { title: "01. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239025&hash=e20f7022cea7f813&hd=3", type: 'vkvideo' },
                    { title: "02. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239026&hash=f8fbd6f05da7cbbe&hd=3", type: 'vkvideo' },
                    { title: "03. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239027&hash=6dc97bb26e8fa3ae&hd=3", type: 'vkvideo' },
                    { title: "04. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239028&hash=ceeaece9ea553490&hd=3", type: 'vkvideo' },
                    { title: "05. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239029&hash=b5c0aebb6665db03&hd=3", type: 'vkvideo' },
                    { title: "06. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239030&hash=528b6f22b4f75bf8&hd=3", type: 'vkvideo' },
                    { title: "07. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239031&hash=2d09bbd791943ff0&hd=3", type: 'vkvideo' },
                    { title: "08. rész", src: "https://vkvideo.ru/video_ext.php?oid=-234646183&id=456239032&hash=bae0897cec8e331d&hd=3", type: 'vkvideo' },
                ]
            },
"fallouts2": {
    title: "Fallout Season 2",
    videos: [
        { 
            title: "01. rész", 
            src: "https://drive.google.com/file/d/1C59WTnOD7rGwI8BwWAndMnc8pVNvjftl/preview", 
            type: 'drive' 
        },
    ]
},
        };

        // --- SEGÉDFÜGGVÉNYEK ---
        function revealMsg(node, text, type = "") { if (!node) return; node.textContent = text; node.className = "form-msg" + (type ? " " + type : ""); }

function checkTitleOverflow() {
    // Adjunk egy kis időt a renderelésnek
    setTimeout(() => {
        document.querySelectorAll('.series-title').forEach(titleDiv => {
            const titleSpan = titleDiv.querySelector('span');
            if (!titleSpan) return;

            // Eredeti tartalom mentése, ha még nincs
            if (!titleSpan.hasAttribute('data-original')) {
                titleSpan.setAttribute('data-original', titleSpan.innerHTML);
            }
            
            const originalText = titleSpan.getAttribute('data-original');
            titleSpan.innerHTML = originalText; // Visszaállítjuk méréshez
            titleDiv.classList.remove('scrolling-title');

            const containerWidth = titleDiv.clientWidth;
            const textWidth = titleSpan.offsetWidth;

            if (textWidth > containerWidth) {
                // Szóköz és duplázás a folytonos hatáshoz
                const spacing = "&nbsp;".repeat(10);
                titleSpan.innerHTML = originalText + spacing + originalText + spacing;
                
                // Sebesség kiszámítása pixel alapján (pixel / sebesség = másodperc)
                const duration = (titleSpan.offsetWidth / 2) / 40; 
                titleSpan.style.animationDuration = duration + 's';
                titleDiv.classList.add('scrolling-title');
            }
        });
    }, 300); // 300ms késleltetés a biztos betöltődésért
}

        // debounce helper to avoid excessive recalculations on resize
        function debounce(fn, wait) {
            let t = null;
            return function (...args) {
                clearTimeout(t);
                t = setTimeout(() => fn.apply(this, args), wait);
            };
        }

        function createIframe(src, type) {
            const iframe = document.createElement('iframe');
            iframe.allowFullscreen = true;
            iframe.scrolling = 'no';
            iframe.src = src;
            iframe.frameBorder = '0';
            iframe.allow = 'autoplay; fullscreen';
            if (type === 'indavideo') iframe.classList.add('indavideo-player');
            return iframe;
        }

        // --- JAVÍTOTT SZINKRONIZÁLT LEJÁTSZÓ ---
        function updatePlayer(src, type) {
            const videoContainer = document.querySelector('.video-frame-container');
            const glowContainer = document.getElementById('ambilightGlowContainer');

            if (!videoContainer || !glowContainer) return;

            videoContainer.innerHTML = '';
            glowContainer.innerHTML = '';

            const separator = src.includes('?') ? '&' : '?';
            const glowSrc = src + separator + "autoplay=1&mute=1&muted=1&controls=0&background=1";

            const mainIframe = createIframe(src, type);
            const glowIframe = createIframe(glowSrc, type);

            mainIframe.id = "main-vid";
            glowIframe.id = "glow-vid";

            // Behelyezés
            glowContainer.appendChild(glowIframe);
            videoContainer.appendChild(mainIframe);

            // SZINKRON: Ha rákattintasz a videóra, a háttér is frissül, így egyszerre indulnak
            const sync = () => {
                const g = document.getElementById('glow-vid');
                if (g) g.src = glowSrc;
            };
            videoContainer.addEventListener('mousedown', sync, { once: true });
        }

        // Mozi mód gomb hiba nélkül
        // A Mozi mód gomb funkciója (tisztán, egyszeri deklarációval)
        theaterBtn.onclick = () => {
            const isOn = document.body.classList.toggle('theater-mode-on');
            ambilightWrapper.classList.toggle('ambilight-active');

            if (isOn) {
                theaterBtn.innerHTML = '<i class="fa-solid fa-compress"></i> Normál nézet';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                theaterBtn.innerHTML = '<i class="fa-solid fa-expand"></i> Mozi mód';
                theaterBtn.style.opacity = "1"; // Normál módban maradjon látható
            }
        };

        // Automatikus frissítés videóváltáskor (ha mozi módban váltasz részt)
        const originalUpdatePlayer = updatePlayer;
        window.updatePlayer = function (src, type) {
            originalUpdatePlayer(src, type);
            const glow = document.getElementById('ambilightGlowContainer');
            if (document.body.classList.contains('theater-mode-on') && glow) {
                glow.style.display = 'block';
            }
        };

        // Egérmozgás figyelése a gomb elrejtéséhez
        let mouseTimer;
        document.addEventListener('mousemove', () => {
            if (document.body.classList.contains('theater-mode-on')) {
                theaterBtn.style.opacity = "1";
                clearTimeout(mouseTimer);
                mouseTimer = setTimeout(() => {
                    theaterBtn.style.opacity = "0";
                }, 3000); // 3 másodperc mozdulatlanság után eltűnik
            }
        });
        // --- FIREBASE FUNKCIÓK ---
        async function saveProgress(seriesKey, videoIndex) {
            const user = auth.currentUser;
            if (!user) return;
            await set(ref(db, `progress/${user.uid}/${seriesKey}`), { index: videoIndex, timestamp: Date.now() });
        }

        async function loadProgress(seriesKey) {
            const user = auth.currentUser;
            if (!user) return 0;
            const snapshot = await get(child(ref(db), `progress/${user.uid}/${seriesKey}`));
            return snapshot.exists() ? snapshot.val().index : 0;
        }

        function loadAllProgress() {
            const user = auth.currentUser;
            if (!user) return;
            onValue(ref(db, `progress/${user.uid}`), (snapshot) => {
                if (snapshot.exists()) {
                    allProgressData = snapshot.val();
                    populateWatchedList(allProgressData);
                } else {
                    watchedList.innerHTML = '<p style="font-size: 0.85rem; color: #777;">Még nem néztél sorozatot.</p>';
                }
            }, { onlyOnce: true });
        }

        function populateWatchedList(progressData) {
            watchedList.innerHTML = '';
            const watchedItems = Object.keys(progressData).map(key => {
                const info = seriesData[key];
                if (!info) return null;
                return { key, ...info, watchedIndex: progressData[key].index, timestamp: progressData[key].timestamp };
            }).filter(i => i).sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);

            watchedItems.forEach(item => {
                const watchedCount = Math.min(item.watchedIndex + 1, item.videos.length);
                const progressPercent = (watchedCount / item.videos.length) * 100;
                const itemDiv = document.createElement('div');
                itemDiv.className = 'watched-item';
                itemDiv.innerHTML = `
            <div class="watched-title">${item.title}</div>
            <div class="watched-progress-text">${watchedCount}/${item.videos.length} rész</div>
            <div class="progress-container"><div class="progress-bar" style="width: ${progressPercent}%"></div></div>
        `;
                itemDiv.onclick = () => { profileDropdown.style.display = 'none'; loadSeries(item.key); mainPage.style.display = 'none'; seriesPage.style.display = 'flex'; };
                watchedList.appendChild(itemDiv);
            });
        }

        function setupPresence() {
            const user = auth.currentUser;
            if (!user) return;
            const myStatusRef = ref(db, `status/${user.uid}`);
            onValue(ref(db, ".info/connected"), (snap) => {
                if (snap.val() === true) {
                    onDisconnect(myStatusRef).remove();
                    set(myStatusRef, Date.now());
                }
            });
            onValue(ref(db, "status"), (snapshot) => {
                const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                const counter = document.getElementById('user-count');
                if (counter) counter.textContent = count;
                document.getElementById('online-counter').style.display = count > 0 ? 'flex' : 'none';
            });
        }

        // --- ESEMÉNYKEZELŐK ---
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById("loginEmail").value.trim();
            const pass = document.getElementById("loginPassword").value;
            try {
                await setPersistence(auth, browserLocalPersistence);
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (err) { revealMsg(loginMsg, "❌ Hibás belépés.", "error"); }
        };

        logoutBtn.onclick = () => signOut(auth);

        profileBtn.onclick = (e) => {
            e.stopPropagation();
            loadAllProgress();
            profileDropdown.style.display = profileDropdown.style.display === "block" ? "none" : "block";
        };

        document.onclick = (e) => {
            if (!profileDropdown.contains(e.target) && e.target !== profileBtn) profileDropdown.style.display = 'none';
            if (!searchContainer.contains(e.target) && e.target !== searchBtn && searchInput.value === "") searchContainer.classList.remove('active');
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginContainer.style.display = "none";
                appContainer.style.display = "flex";
                setTimeout(() => appContainer.style.opacity = "1", 10);
                usernameDisplay.textContent = user.displayName || user.email.split('@')[0];
                profileName.textContent = usernameDisplay.textContent;
                setupPresence();
                loadAllProgress();
            } else {
                appContainer.style.display = "none";
                loginContainer.style.display = "flex";
            }
        });

        homeBtn.onclick = backBtn.onclick = () => {
            seriesPage.style.display = 'none';
            mainPage.style.display = 'flex';
            searchBtn.style.display = 'flex';
            dynamicBackground.classList.remove('visible');
        };

        theaterBtn.onclick = () => {
            const isOn = document.body.classList.toggle('theater-mode-on');
            ambilightWrapper.classList.toggle('ambilight-active'); // Ez kapcsolja be a fényt
            theaterBtn.classList.toggle('active');

            theaterBtn.innerHTML = isOn ?
                '<i class="fa-solid fa-compress"></i> Normál nézet' :
                '<i class="fa-solid fa-expand"></i> Mozi mód';

            if (isOn) window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        searchBtn.onclick = (e) => { e.stopPropagation(); searchContainer.classList.add('active'); searchInput.focus(); };

        // Kereső mező gépelés figyelése
        searchInput.oninput = () => {
            const q = searchInput.value.toLowerCase();

            // Az X gomb megjelenítése/elrejtése
            searchClearBtn.style.display = q ? 'flex' : 'none';

            document.querySelectorAll('.series-card').forEach(card => {
                const title = card.querySelector('.series-title span').textContent.toLowerCase();
                card.style.display = title.includes(q) ? 'flex' : 'none';
            });

            // Újraellenőrizzük a hosszú címeket a találatoknál
            checkTitleOverflow();
        };

        // AZ X GOMB FUNKCIÓJA (Ez hiányzott):
        searchClearBtn.onclick = (e) => {
            e.stopPropagation(); // Megakadályozzuk, hogy a konténer bezáródjon
            searchInput.value = ""; // Mező ürítése
            searchClearBtn.style.display = 'none'; // Gomb elrejtése
            searchInput.focus(); // Fókusz visszaállítása

            // Összes kártya megjelenítése újra
            document.querySelectorAll('.series-card').forEach(card => {
                card.style.display = 'flex';
            });

            checkTitleOverflow();
        };

        async function loadSeries(key) {
            const s = seriesData[key];
            if (!s) return;
            seriesTitle.textContent = s.title;
            videoList.innerHTML = "";
            const lastIdx = await loadProgress(key);
            updatePlayer(s.videos[lastIdx].src, s.videos[lastIdx].type);

            const img = document.querySelector(`.series-card[data-series="${key}"] img`);
            if (img) {
                dynamicBackground.style.backgroundImage = `url('${img.src}')`;
                dynamicBackground.classList.add('visible');
            }

            s.videos.forEach((v, i) => {
                const card = document.createElement('div');
                card.className = 'video-card' + (i === lastIdx ? ' active' : '');

                // --- ÚJ RÉSZ: Belső span a görgetéshez ---
                card.innerHTML = `<div class="video-card-title"><span>${v.title}</span></div>`;

                card.onclick = () => {
                    updatePlayer(v.src, v.type);
                    document.querySelectorAll('.video-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    saveProgress(key, i);
                };

                videoList.appendChild(card);

                // --- ÚJ RÉSZ: Szöveghossz ellenőrzése a beillesztés után ---
                const titleContainer = card.querySelector('.video-card-title');
                const titleSpan = titleContainer.querySelector('span');

                // Ha a szöveg szélesebb, mint a konténer, aktiváljuk a CSS animációt
                if (titleSpan.offsetWidth > titleContainer.offsetWidth) {
                    titleContainer.classList.add('scrolling');
                }
            });
        }
        document.querySelectorAll('.series-card').forEach(c => c.onclick = () => { loadSeries(c.dataset.series); mainPage.style.display = 'none'; seriesPage.style.display = 'flex'; });

        // Initialize title overflow handling and keep it up-to-date on resize or filtering
        checkTitleOverflow();
        window.addEventListener('resize', debounce(checkTitleOverflow, 150));
        let captureStream = null;
        let colorInterval = null;

        // --- MOZI MÓD ÉS FÉNYEK FIXÁLVA ---
        theaterBtn.onclick = () => {
            const isOn = document.body.classList.toggle('theater-mode-on');
            const glow = document.getElementById('ambilightGlowContainer');

            ambilightWrapper.classList.toggle('ambilight-active');

            if (isOn) {
                if (glow) {
                    glow.style.display = 'block';
                    // Itt kényszerítjük a böngészőt, hogy a videó alatti területet mossa el
                    glow.style.backdropFilter = "blur(80px) brightness(1.5) saturate(1.8)";
                    glow.style.webkitBackdropFilter = "blur(80px) brightness(1.5) saturate(1.8)";
                }
                theaterBtn.innerHTML = '<i class="fa-solid fa-compress"></i> Normál nézet';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                if (glow) {
                    glow.style.display = 'none';
                    glow.style.backdropFilter = "none";
                    glow.style.webkitBackdropFilter = "none";
                }
                theaterBtn.innerHTML = '<i class="fa-solid fa-expand"></i> Mozi mód';
            }
        };

        // Automatikus frissítés videóváltáskor

        updatePlayer = function (src, type) {
            originalUpdatePlayer(src, type);
            const glow = document.getElementById('ambilightGlowContainer');
            if (document.body.classList.contains('theater-mode-on') && glow) {
                glow.style.display = 'block';
            }
        };
    </script>
</body>

</html>
